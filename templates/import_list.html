{% extends "base.html" %}
{% block content %}
<main class="shifted p-4 lg:p-6">
    <h2>Import List</h2>
        <link rel="stylesheet" href="/static/custom-margins.css">
    <form id="csvUploadForm" method="POST" enctype="multipart/form-data">
        <label for="campaign_name">Campaign Name:</label>
        <input type="text" name="campaign_name" id="campaign_name" placeholder="Enter campaign name" required><br><br>
        <label for="file">Select CSV file:</label>
        <input type="file" name="file" id="file" accept=".csv" required><br><br>
        <button type="button" id="uploadBtn">Upload</button>
    </form>
    <div id="headerMapping" style="display:none; margin-top:20px;">
        <h3>Map CSV Headers</h3>
        <div id="headersList"></div>
        <button id="importBtn">Import</button>
    </div>
</main
<script>
document.getElementById('uploadBtn').onclick = function() {
    const fileInput = document.getElementById('file');
    if (!fileInput.files.length) return alert('Please select a CSV file.');
    // Simulate header extraction (replace with AJAX in production)
    const fakeHeaders = ['Name', 'Phone', 'Address', 'Tag'];
    const headersList = document.getElementById('headersList');
    headersList.innerHTML = fakeHeaders.map(h => `<div><label>${h}</label> <select><option>Contact Name</option><option>Phone</option><option>Address</option><option>Tag</option></select></div>`).join('');
    document.getElementById('headerMapping').style.display = 'block';
};
document.getElementById('importBtn').onclick = function() {
    // Collect mapped headers
    const headerDivs = document.querySelectorAll('#headersList > div');
    const mappings = Array.from(headerDivs).map(div => {
        const label = div.querySelector('label').textContent;
        const value = div.querySelector('select').value;
        return { header: label, mappedTo: value };
    });
    // Collect campaign name and file
    const campaignName = document.getElementById('campaign_name').value;
    const fileInput = document.getElementById('file');
    if (!fileInput.files.length) return alert('No file selected.');
    const file = fileInput.files[0];
    const formData = new FormData();
    formData.append('campaign_name', campaignName);
    formData.append('file', file);
    formData.append('mappings', JSON.stringify(mappings));
    fetch('/import-contacts', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Import successful!');
        } else {
            alert('Import failed: ' + (data.error || 'Unknown error'));
        }
    })
    .catch(err => {
        alert('Error importing: ' + err);
    });
};
</script>
    <div class="container list-main">
{% endblock %}
